<view wx:if="{{role=='staff'}}">
  <block wx:if="{{orderId == 0}}" >
    <mp-cells title="支付方式" >
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >支付方式：</view>
          <view class="right-column" >
            <picker mode="selector" range="{{payMethodList}}" bindchange="payMethodChanged" >
              <picker-view>{{payMethodList[payMethodSelectedIndex]}}</picker-view>
            </picker>
          </view>
        </view>
      </mp-cell>
    </mp-cells>
    <user-info wx:if="{{userInfoDisplay}}" open_id="{{open_id}}" cell="{{cell}}" code="{{code}}" bindUserFound="userFound" bindUserInfoUpdate="userUpdate" ></user-info>
    <ticket-selector wx:if="{{ticketsRefresh}}" ticket_code_arr="{{code}}" bindTicketSelected="ticketSelected" ></ticket-selector>
    <mp-cells>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >优惠金额：</view>
          <view class="right-column" ><input placeholder="输入减免金额"  bindinput="ticketDiscount"  /></view>
        </view>
      </mp-cell>
    </mp-cells>
    <shop-selector bindShopSelected="shopSelected" ></shop-selector>
    <mp-cells title="订单信息 智慧商贸订单可以为多个" >
      <block wx:for="{{mi7Orders}}">
        <mp-cell>
          <view>订单{{index+1}}</view>
        </mp-cell>
        <mp-cell>
          <view style="display: flex;flex-direction: row;"  >
            <view class="left-column"  >智慧商贸单号：</view>
            <view class="right-column"  >
              <input id="mi7OrderNo_{{index}}" value="{{item.mi7OrderNo}}"   placeholder="填写智慧商贸订单号" bindinput="modMi7Order" />
            </view>
          </view>
        </mp-cell>
        <mp-cell>
          <view style="display: flex;flex-direction: row;"  >
            <view class="left-column"  >零售总价：</view>
            <view class="right-column" ><input id="mi7OrderSalePrice_{{index}}"   placeholder="填写零售总价" bindinput="modMi7Order" value="{{item.mi7OrderSalePrice}}" /></view>
          </view>
        </mp-cell>
        <mp-cell>
          <view style="display: flex;flex-direction: row;"  >
            <view class="left-column"  >订单总价：</view>
            <view class="right-column" ><input id="mi7OrderChargePrice_{{index}}"  placeholder="填写成交总价" bindinput="modMi7Order" value="{{item.mi7OrderChargePrice}}"  /></view>
          </view>
        </mp-cell>
      </block>
      <mp-cell>
        <button bindtap="addMi7Order"> 添 加 下 一 单 </button>
      </mp-cell>
    </mp-cells>
    <mp-cells title="订单小计" >
      <mp-cell>
        <view style="display: flex;flex-direction: row;"  >
          <view class="left-column"  >零售总价：</view>
          <view class="right-column" >¥{{totalSalePrice}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;"  >
          <view class="left-column"  >订单总价：</view>
          <view class="right-column" >¥{{totalChargePrice}}</view>
        </view>
      </mp-cell>
    </mp-cells>
    
    
    
    
    <mp-cells title="结算信息" >
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >应付金额：</view>
          <view class="right-column" >¥{{totalSalePrice}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >优惠券减免：</view>
          <view class="right-column" >¥{{totalChargePrice - ticketDiscount}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >额外减免：</view>
          <view class="right-column" ><input placeholder="输入额外减免金额" bindinput="othersDiscount"  /></view>
        </view>
      </mp-cell>
      <mp-cell >
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >支付选项：</view>
          <view class="right-column" >
            <picker mode="selector" range="{{payOptionList}}" bindchange="payOptionChanged">
              <picker-view>{{payOptionList[payOptionSelectedIndex]}}</picker-view>
            </picker>
          </view>
        </view>
      </mp-cell>
      <mp-cell >
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >本次支付金额：</view>
          <view class="right-column" >
            <view wx:if="{{payOptionSelectedIndex!=1}}" >¥{{totalChargePrice - ticketDiscount - othersDiscount}}</view>
            <view wx:else style="display: flex; flex-direction: row;">¥<input placeholder="填写支付金额" bindinput="setCurrentCharge" /></view>
          </view>
        </view>
      </mp-cell>
      <mp-cell >
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >龙珠系数：</view>
          <view class="right-column" >{{scoreRate}}</view>
        </view>
      </mp-cell>
      <mp-cell >
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >获得龙珠：</view>
          <view class="right-column" >{{score}}</view>
        </view>
      </mp-cell>
      <!--
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >获得龙珠：</view>
          <view class="right-column" >{{score}}颗</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >现有龙珠：</view>
          <view class="right-column" >x颗</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >到期优惠券：</view>
          <view class="right-column" >x张</view>
        </view>
      </mp-cell>
      -->
      <mp-cell >
        <button bindtap="submit" > 提 交 </button>
      </mp-cell>
    </mp-cells>
  </block>
  <block wx:else >
    <view style="text-align: center;">订单确认</view>
    
    
    <mp-cells title="顾客信息" >
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >手机号：</view>
          <view class="right-column" >{{user_info.cell_number}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >称呼：</view>
          <view class="right-column" wx:if="{{user_info.gender=='女'}}" >{{user_info.real_name}} 女士</view>
          <view class="right-column" wx:else >{{user_info.real_name}} 先生</view>
        </view>
      </mp-cell>
    </mp-cells>
    <mp-cells title="支付金额" >
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >零售总价：</view>
          <view class="right-column" >¥{{submitedOrder.order_price}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >订单总价：</view>
          <view class="right-column" >¥{{submitedOrder.order_real_pay_price}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >优惠券减免：</view>
          <view class="right-column" >¥{{submitedOrder.ticket_amount}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >额外减免：</view>
          <view class="right-column" >¥{{submitedOrder.other_discount}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >本次支付金额：</view>
          <view class="right-column" >{{submitedOrder.final_price}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >龙珠系数：</view>
          <view class="right-column" >{{submitedOrder.score_rate}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >预计获得龙珠：</view>
          <view class="right-column" >{{submitedOrder.generate_score}}</view>
        </view>
      </mp-cell>
    </mp-cells>
    <mp-cells title="支付方式">
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >支付方式：</view>
          <view class="right-column" >{{submitedOrder.pay_method}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >支付选项：</view>
          <view class="right-column" >{{submitedOrder.pay_memo}}</view>
        </view>
      </mp-cell>
      <mp-cell wx:if="{{submitedOrder.pay_memo!='无需支付'}}" >
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >本次支付：</view>
          <view class="right-column"    >{{submitedOrder.payments[0].amount}}</view>
        </view>
      </mp-cell>
    </mp-cells>
    <mp-cells title="优惠券" wx:if="{{orderTicket!=null}}" >
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >优惠券码：</view>
          <view class="right-column" >{{orderTicket.code}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >优惠券码：</view>
          <view class="right-column" >{{orderTicket.name}}</view>
        </view>
      </mp-cell>
      <mp-cell>
        <view style="display: flex;flex-direction: row;" >
          <view class="left-column"  >状态：</view>
          <view class="right-column" wx:if="{{orderTicket.used == 0}}" >未核销</view>
          <view class="right-column"  wx:else >已核销</view>
        </view>
      </mp-cell>
    </mp-cells>
  </block>
</view>