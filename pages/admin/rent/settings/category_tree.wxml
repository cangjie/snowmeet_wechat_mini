<view wx:if="{{isAdmin}}">
  <tree
    dataTree="{{dataTree}}"
    selectKey="{{(selectedCategory!=undefined && selectedCategory!=null)? selectedCategory.id:''}}"
    bind:select="handleSelect"
    isSelectLastNode="true"
    isOpenAll="{{false}}"
    checkBox="{{false}}"
  ></tree>
  <mp-cells title="å½“å‰åˆ†ç±»" >
    <mp-cell>
      <view class="view-row">
        <view wx:if="{{selectedCode==''}}" >é¡¶çº§</view>
        <view wx:else>{{selectedDisplayedCode}} {{selectedCategory.name}}</view>
      </view>
    </mp-cell>
  </mp-cells>
  <mp-cells title="ä¿®æ”¹åˆ†ç±»" >
    <mp-cell>
      <view class="view-row" style="margin: 10rpx" >
        <view class="left-column" style="width: 250rpx;display: flex;flex-direction: row;" >
          <view style="margin-top: 7rpx;width: 200rpx;">{{grandpaDisplayedCode}}</view>
          <input id="modSeq" value="" style="width: 50rpx; text-align: center;" class="input" 
            disabled="{{selectedCategory == null || selectedCategory == undefined || selectedCategory.name == ''}}"
            placeholder="{{seq}}"
            bindinput="setModName"
            value="{{seq}}"
          />
        </view>
        <view class="right-column" style="width: 450rpx;" >
          <input id="modName" class="input" style="margin-left: auto; margin-right: auto;text-align: center; width: 260rpx;" 
            placeholder="{{selectedCategory.name}}" 
            disabled="{{selectedCategory == null || selectedCategory == undefined || selectedCategory.name == ''}}" 
            bindinput="setModName" 
            value="{{modName}}" />
        </view>
      </view>
    </mp-cell>
    <mp-cell>
      <view class="view-row" >
        <button  class="input" style="margin-left: auto; margin-right: auto;" 
        disabled="{{selectedCategory == null || selectedCategory == undefined || selectedCategory.name == '' || modName == ''}}"  bind:tap="modCategoryName" > ç¡® è®¤ ä¿® æ”¹ </button>
      </view>
    </mp-cell>

  </mp-cells>

  <mp-cells title="æ·»åŠ åˆ†ç±»" >
    <mp-cell>
      <view class="view-row" >
        <view class="left-column" >åˆ†ç±»åºå·ï¼š</view>
        <view class="right-column" class="view-row">
          <view>{{fatherDisplayedCode}}</view>
          <input id="newSeq" bindinput="setNewCategory" class="input" style="width: 50rpx;" disabled="{{selectedCategory == undefined}}" value="{{newSeq}}" /></view>
          <view style="width: 50rpx;"></view>
          <switch bindchange="checkSameLevel" disabled="{{selectedCategory == undefined}}" checked="{{isSameLevel}}"  >åŒçº§</switch>
      </view>
    </mp-cell>
    <mp-cell>
      <view class="view-row" >
        <view class="left-column" >åˆ†ç±»åç§°ï¼š</view>
        <view class="right-column">
          <input id="newSeqName" bindinput="setNewCategory" class="input" style="width: 200rpx;" disabled="{{selectedCategory == undefined}}"  value="{{newName}}" />
        </view>
      </view>
    </mp-cell>
    <mp-cell>
      <button class="input" disabled="{{selectedCategory == undefined}}" bind:tap="addCategory"  > æ·» åŠ  åˆ† ç±» </button>
    </mp-cell>
  </mp-cells>
  <mp-cells title="æŠ¼é‡‘è®¾å®š" >
    <view style="display:flex;justify-content: center;" >
      <input class="input" id="deposit" bindinput="setNumber" style="width: 150rpx; text-align: center;" value="{{selectedCategory.deposit}}" disabled="{{selectedCategory == undefined || selectedCategory.children != null}}" />
    </view>
  </mp-cells>
  <mp-cells title="ä»·æ ¼è®¾å®š" >
    <mp-cell>
      <price-matrix 
      priceMatrix="{{priceArr}}" 
      fieldRow="{{['é—¨å¸‚', 'é¢„çº¦', 'ä¼šå‘˜']}}" 
      fieldCol="{{['å¹³æ—¥','å‘¨æœ«','èŠ‚å‡æ—¥']}}" 
      bindmod="modPrice"
      bindTabChange="tabChange"
      disabled="{{matrixDisabled}}"
      ></price-matrix>
     
      
    </mp-cell>
  </mp-cells>
  <mp-cells title="ä¿å­˜ç§Ÿé‡‘æŠ¼é‡‘è®¾ç½®">
    <mp-cell>
        <view style="color: red;">{{canSave? '': canSaveMsg}}</view>
    </mp-cell>
    <mp-cell><button class="input" disabled="{{!canSave || isSaving}}" bind:tap="save" > ä¿ å­˜ </button></mp-cell>
  </mp-cells>
  <mp-cells title="ç§Ÿèµå•†å“ä¿¡æ¯å­—æ®µè®¾å®š" >
    <mp-cell>
      <view class="view-row" >
        <view style="width:400rpx; text-align:  center;">å­—æ®µåç§°</view>
        <view style="text-align: center;display: flex;margin: auto;">æ“ä½œ</view>
      </view>
      <view class="view-row" style="height: 80rpx;" wx:for="{{selectedCategory.infoFields}}" wx:if="{{item.is_delete==0}}" >

        <view style="width:400rpx; text-align:  center;">
          <input style="margin-left: auto; margin-right: auto; width: 350rpx;" class="input" value="{{item.field_name}}" bindinput="setFieldName" id="{{item.id}}" />
        </view>

        <view class="view-row" style="width:150rpx; text-align:  center;">
          <view style="margin-left:10rpx;margin-right:10rpx">
            <button id="name_{{item.id}}" bind:tap="modFields"
            style="width: 45rpx;height: 45rpx; padding: 0rpx; margin: 0rpx; font-size: 11pt;border:0rpx" 
            disabled="{{selectedCategory.code.length != 2 || item.mod!=true}}" class="input" >ğŸ’¾</button>
          </view>
          
          <view style="margin-left:10rpx;margin-right:10rpx">
            <button id="up_{{item.id}}" bind:tap="modFields"
            style="width: 45rpx;height: 45rpx; padding: 0rpx; margin: 0rpx; font-size: 11pt;border:0rpx" 
            disabled="{{selectedCategory.code.length != 2}}" class="input" >â¬†ï¸</button>
          </view>
         
          <view style="margin-left:10rpx;margin-right:10rpx">
            <button id="down_{{item.id}}" bind:tap="modFields"
            style="width: 45rpx;height: 45rpx; padding: 0rpx; margin: 0rpx; font-size: 11pt;border:0rpx"  
            disabled="{{selectedCategory.code.length != 2}}" class="input" >â¬‡ï¸</button>
          </view>

          <view style="margin-left:10rpx;margin-right:10rpx">
            <button  id="del_{{item.id}}" bind:tap="modFields"
            style="width: 45rpx;height: 45rpx; padding: 0rpx; margin: 0rpx; font-size: 11pt;border:0rpx"  
            disabled="{{selectedCategory.code.length != 2}}" class="input" >ğŸ—‘ï¸</button>
          </view>

        </view>
      </view>
      <view class="view-row" >
        <view style="width:400rpx; text-align:  center;">
          <input style="margin-left: auto; margin-right: auto; width: 350rpx;" class="input" value="{{newFieldName}}" placeholder="æ·»åŠ æ–°å­—æ®µ" bindinput="setNewFieldName" />
        </view>
        <view class="view-row" style=" text-align:  center;">
          <button style="width: 260rpx;height: 45rpx; padding: 0rpx; margin: 0rpx; font-size: 11pt;border:0rpx" 
          disabled="{{newFieldName == '' || selectedCategory.code.length != 2}}" 
          class="input" bind:tap="addNewField" > æ·» åŠ  æ–° å­— æ®µ </button>
        </view>
        
      </view>
    </mp-cell>
  </mp-cells>
  <mp-cells title="åˆ é™¤åˆ†ç±»">
    <mp-cell>
      <button disabled="{{ (selectedCategory.children != undefined  && selectedCategory.children != null) || selectedCategory == undefined}}" class="input" bind:tap="metionDelete" > åˆ  é™¤ </button>
    </mp-cell>
  </mp-cells>
</view>